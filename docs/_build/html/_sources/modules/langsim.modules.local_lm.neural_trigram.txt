Neural trigram trainer
~~~~~~~~~~~~~~~~~~~~~~

.. py:module:: langsim.modules.local_lm.neural_trigram

+------------+-----------------------------------------+
| Path       | langsim.modules.local_lm.neural_trigram |
+------------+-----------------------------------------+
| Executable | yes                                     |
+------------+-----------------------------------------+

A second, cleaned-up implementation of the neural trigram model. This supersedes the original
neural_trigram trainer.

This has been superseded now by neural_sixgram, but I'm keeping it here, as it is a simpler
model and also seemed to work well, so we might want to try it in future when training on
small datasets.


Inputs
======

+---------+------------------------------------------------------------------------------------------------------------------------+
| Name    | Type(s)                                                                                                                |
+=========+========================================================================================================================+
| vocabs  | :class:`list <pimlico.datatypes.base.MultipleInputs>` of :class:`Dictionary <pimlico.datatypes.dictionary.Dictionary>` |
+---------+------------------------------------------------------------------------------------------------------------------------+
| corpora | :class:`list <pimlico.datatypes.base.MultipleInputs>` of TarredCorpus<IntegerListsDocumentType>                        |
+---------+------------------------------------------------------------------------------------------------------------------------+

Outputs
=======

+-------+----------------------------------------------------------+
| Name  | Type(s)                                                  |
+=======+==========================================================+
| model | :class:`~pimlico.datatypes.keras.KerasModelBuilderClass` |
+-------+----------------------------------------------------------+

Options
=======

+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------+
| Name               | Description                                                                                                                                                                                                                                                                                                                                                                                                 | Type                                                                                          |
+====================+=============================================================================================================================================================================================================================================================================================================================================================================================================+===============================================================================================+
| embedding_size     | Number of dimensions in the hidden representation. Default: 200                                                                                                                                                                                                                                                                                                                                             | int                                                                                           |
+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------+
| plot_freq          | Output plots to the output directory while training is in progress. This slows down training if it's done very often. Specify how many batches to wait between each plot. Fewer means you get a finer grained picture of the training process, more means training goes faster. 0 (default) turns off plotting                                                                                              | int                                                                                           |
+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------+
| dropout            | Dropout to apply to embeddings during training. Default: 0.3                                                                                                                                                                                                                                                                                                                                                | float                                                                                         |
+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------+
| epochs             | Max number of training epochs. Default: 5                                                                                                                                                                                                                                                                                                                                                                   | int                                                                                           |
+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------+
| predictor_layers   | Number and size of layers to use to take a pair of vectors and say whether they belong beside each other. Given as a list of integers. Doesn't include the final projection to a single score                                                                                                                                                                                                               | comma-separated list of ints                                                                  |
+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------+
| negatives          | Determines how negative trigrams are drawn. Choose 'unigram' to draw three independent phonemes from the unigram distribution of the same language as the positive trigram. Choose 'trigram' to draw a roughly-pseudo-random-ish trigram from elsewhere in the same corpus as the positive. Note that this interacts with the model variant and some combinations make less, or no, sense. Default: unigram | 'unigram' or 'trigram'                                                                        |
+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------+
| limit_training     | Limit training to this many batches. Default: no limit                                                                                                                                                                                                                                                                                                                                                      | int                                                                                           |
+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------+
| composition_layers | Number and size of layers to use to combine pairs of characters, given as a list of integers. The final layer must be the same size as the embeddings, so is not included in this list                                                                                                                                                                                                                      | comma-separated list of ints                                                                  |
+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------+
| model_variant      | Use one of the alternative model structures that exist in the code from my experiments with different structures. The default ('original') is identical to the original neural trigram model                                                                                                                                                                                                                | 'original', 'bpr_pairs', 'neg_outer', 'all_neg_pairs', 'all_negs', 'bigram' or 'trigram_only' |
+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------+
| batch              | Training batch size. Default: 100                                                                                                                                                                                                                                                                                                                                                                           | int                                                                                           |
+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------+
| sim_freq           | How often (in batches) to compute the similarity of overlapping phonemes between the languages. -1 (default) means never, 0 means once at the start of each epoch                                                                                                                                                                                                                                           | int                                                                                           |
+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------+
| corpus_offset      | To avoid training on parallel data, in the case where the input corpora happen to be parallel, jump forward in the second corpus by this number of utterances, putting the skipping utterances at the end instead. Default: 10k utterances                                                                                                                                                                  | int                                                                                           |
+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------+
| validation         | Number of samples to hold out as a validation set for training. Simply taken from the start of the corpus. Rounded to the nearest number of batches                                                                                                                                                                                                                                                         | int                                                                                           |
+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------+

