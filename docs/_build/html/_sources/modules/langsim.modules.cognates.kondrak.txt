Kondrak-inspired cognate identification
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. py:module:: langsim.modules.cognates.kondrak

+------------+----------------------------------+
| Path       | langsim.modules.cognates.kondrak |
+------------+----------------------------------+
| Executable | yes                              |
+------------+----------------------------------+

Implementation of an adaptation of Kondrak's CORDI model to our situation where no initial cognate list is
available to learn recurrent phoneme mappings from.

The original model is described in
`Identification of Cognates and Recurrent Sound Correspondences in Word Lists, Kondrak (2009) <https://www.atala.org/IMG/pdf/TAL-2009-50-2-08-Kondrak.pdf>`_.

Takes as input two word lists, for different languages, each encoding the words in terms of indices in
that language's phoneme vocabulary. Also requires an array specifying the initial table of link likelihoods
between the two phoneme vocabularies, size ``(N, M)`` where ``N`` is the number of phonemes in language1 and
``M`` the number in language2.


Inputs
======

+-----------------+----------------------------------------------------------------------+
| Name            | Type(s)                                                              |
+=================+======================================================================+
| word_list1      | :class:`WordDictionary <langsim.datatypes.word_dict.WordDictionary>` |
+-----------------+----------------------------------------------------------------------+
| word_list2      | :class:`WordDictionary <langsim.datatypes.word_dict.WordDictionary>` |
+-----------------+----------------------------------------------------------------------+
| initial_weights | :class:`NumpyArray <pimlico.datatypes.arrays.NumpyArray>`            |
+-----------------+----------------------------------------------------------------------+

Outputs
=======

+--------+------------------------------------------------------------+
| Name   | Type(s)                                                    |
+========+============================================================+
| output | :class:`~langsim.datatypes.kondrak.KondrakAlgorithmOutput` |
+--------+------------------------------------------------------------+

Options
=======

+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+
| Name                           | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Type  |
+================================+=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+=======+
| small_pool_size                | Number of candidate word pairs to re-align and score on each iteration to recompute the likelihood scores. The pool is initially formed from the highest scoring of all word pairs. We then perform a number (small_pool_updates) of re-alignments and likelihood updates before re-aligning the whole of the large pool to allow for some word pairs having moved up into or down out of the small pool. Should be a small number (e.g. 500) that can be quickly re-aligned many times over, considerably smaller than large_pool_size | int   |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+
| max_iters                      | Maximum number of iterations (large pool updates) to carry out before giving up, if convergence has not been reached                                                                                                                                                                                                                                                                                                                                                                                                                    | int   |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+
| large_pool_size                | Number of candidate word pairs to keep in the large pool. When we first align all word pairs, we keep only this many highest scoring candidates for aligning in future comparisons. This should be quite a large number (larger than small_pool_size), but considerably smaller than the total number of word pairs (len(word_list1)*len(word_list2))                                                                                                                                                                                   | int   |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+
| convergence                    | Consider the link likelihood distribution to have converged once the total change in probabilities over the whole distribution drops below this value. 0.0001 was used originally by Melamed in the MT model                                                                                                                                                                                                                                                                                                                            | float |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+
| low_count_threshold            | Threshold to apply to alignment counts when computing PMI statistic for each phoneme pair. It is important to apply a threshold, so that you don't get very high or low weights for alignments between rare phonemes. If either phoneme has a count lower than this in the sample, the PMI is set to zero                                                                                                                                                                                                                               | int   |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+
| ins_del_cost                   | Small penalty to use for insertions and deletions when aligning word pairs using the CORDI alignment method. Should always be >0, otherwise you end up with many equivalent alignments, slowing down the algorithm hugely. (This could potentially be solved, but since Kondrak uses a penalty and we have no reason not to, I've not done so.)                                                                                                                                                                                         | float |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+
| small_pool_updates             | Number of re-alignment and likelihood update cycles to perform on the small pool before realigning everything in the large pool to re-rank and form a new small pool                                                                                                                                                                                                                                                                                                                                                                    | int   |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+
| initial_filter_large_pool_size | Number of candidate word pairs to include in the very first large pool created. We do a very rough comparison of the word pairs, just looking at the first few phonemes, and throw away those that look unlikely to produce a high scoring alignment. This should be much larger than large_pool_size, but small enough that scoring all resulting pairs is feasible                                                                                                                                                                    | int   |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+
| top_words                      | By default, all word pairs between the languages are considered (as far as the initial filter, at least). If top_words is given, only consider this number of words from each language                                                                                                                                                                                                                                                                                                                                                  | int   |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+
| count_prior                    | Prior to use for independent and joint phoneme distributions. Effectively, Laplace smoothing applied to the counts                                                                                                                                                                                                                                                                                                                                                                                                                      | float |
+--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+

